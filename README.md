# WP GrokLink 过滤器

**版本:** 1.0.0  
**作者:** Gemini  
**许可协议:** GPL-3.0

---

一个简洁高效的WordPress插件，用于自动查找并移除您页面、文章及同源iframe中的一系列`<grok...>`标签及其内容。

## 🌟 核心功能

- **服务器端过滤:** 通过PHP直接从文章和页面内容中移除标签，实现最高的效率和可靠性。
- **客户端Iframe过滤:** 在页面加载后，尝试移除`<iframe>`元素内部的标签。
- **灵活的标签匹配:** 使用功能强大的正则表达式，不仅能捕获`<grok>`，还能捕获如`<grok:render>`、`<grok-custom-tag>`等一系列相关标签。
- **轻量级:** 没有复杂的后台设置，即装即用。
- **即插即用:** 激活后即可自动工作。

## ⚙️ 工作原理

插件通过两个层面进行工作，以确保过滤的全面性。

### 1. PHP服务器端过滤 (主要方法)

这是插件最核心、最稳定的部分。它挂载到WordPress标准的`the_content`过滤器上。在任何页面或文章展示给用户之前，插件会运行正则表达式，查找并剥离所有匹配的`<grok...>`标签及其包裹的内容。

- **钩子 (Hook):** `add_filter( 'the_content', 'groklink_filter_the_content' );`
- **核心函数:** `preg_replace()`

### 2. JavaScript客户端过滤 (用于Iframe)

对于在`<iframe>`中加载的内容，PHP无法直接干预。因此，插件会加载一个轻量的JavaScript文件，在主页面加载完成后执行。

该脚本会等待页面上的每个`<iframe>`加载完成，然后检查其内部文档，并移除所有匹配的`<grok...>`标签。

> **⚠️ 重要限制：同源策略 (Same-Origin Policy)**
> 由于浏览器的安全规则，本插件的JavaScript部分 **仅能** 访问和修改与您的主网站来自 **相同域名** 的iframe内容。它无法修改那些显示来自外部网站（如：YouTube、Vimeo或其他第三方网站）的iframe。

### 正则表达式详解

为了提供灵活性，插件使用了以下正则表达式：

```regex
/<(grok[\w:-]*)(?:[^>]*)>.*?<\/\1>/is
```

- `<(grok[\w:-]*)>`: 捕获任何以`grok`开头，后跟字母、数字、下划线、冒号或连字符的标签（例如 `grok`, `grok:render`, `grok-data`）。标签名本身会被捕获。
- `(?:[^>]*)>`: 匹配开始标签的剩余部分，包括任何属性。
- `.*?`: 以非贪婪模式匹配标签内的所有内容。
- `<\/\1>`: 这是最关键的部分。它会查找一个与第一部分捕获的标签名完全匹配的闭合标签。因此，`<grok:render>` 会被 `</grok:render>` 闭合，但不会被 `</grok>` 闭合。

## 🛠️ 安装步骤

1.  **下载:** 从本仓库下载插件文件。
2.  **上传:** 导航到您的WordPress后台 -> **插件** -> **安装插件** -> **上传插件**。
3.  **选择文件:** 选择下载的`.zip`压缩包。
4.  **安装并激活:** 安装插件，然后点击 **激活**。

或者，您也可以通过FTP等方式，手动将插件文件夹 (`wp-groklink`) 上传到服务器的 `/wp-content/plugins/` 目录下。

## 🚀 使用方法

插件激活后，将自动开始工作，无需进行任何配置。它会立即开始过滤您网站内容和同源iframe中的`<grok...>`标签。

## 📜 许可协议

本插件基于 **GPL-3.0** 许可协议开源。您可以自由地使用、修改和分发它。